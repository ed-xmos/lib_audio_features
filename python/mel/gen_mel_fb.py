import sys
import numpy as np
import os

import matplotlib
matplotlib.use("TkAgg")
import matplotlib.pyplot as plt

from feature_utils import mel_filterbank

PLOTTING = 1  # turn on/off plotting

VAD_MEL_MAX = 16777216

def print_full_mel(fbank):
    print(fbank.shape)
    old_nz = 0
    for bank in fbank.tolist():
        num_zeros = 0
        for value in bank:
            if value != 0.0:
                break;
            num_zeros += 1

        print(num_zeros, num_zeros - old_nz, bank[:40])
        old_nz = num_zeros

# fmt: off
mel_fb_c = {
	"0":
		[  # f_low = 0 Hz
			0,  16777216,  # 0
			0,  16777216,  8388608,  # 1
			0,  16777216,  8388608,  # 2
			0,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  8388608,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  8388608,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 12
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13421772,  10066329,  6710886,  3355443,  # 15
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 18
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 22
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  15486660,  14196105,  12905550,  11614995,  10324440,  9033885,  7743330,  6452775,  5162220,  3871665,  2581110,  1290555,  # 23
			0,  1198372,  2396745,  3595117,  4793490,  5991862,  7190235,  8388608,  9586980,  10785353,  11983725,  13182098,  14380470,  15578843,  16777216,  # 24
		],
	"31.25":
		[  # f_low = 31.25 Hz
			0,  16777216,  # 0
			0,  16777216,  8388608,  # 1
			0,  16777216,  8388608,  # 2
			0,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  8388608,  16777216,  11184810,  5592405,  # 6
			0,  8388608,  16777216,  11184810,  5592405,  # 7
			0,  8388608,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 22
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  15486660,  14196105,  12905550,  11614995,  10324440,  9033885,  7743330,  6452775,  5162220,  3871665,  2581110,  1290555,  # 23
			0,  1198372,  2396745,  3595117,  4793490,  5991862,  7190235,  8388608,  9586980,  10785353,  11983725,  13182098,  14380470,  15578843,  16777216,  # 24
	],
	"62.5":
		[  # f_low = 62.5 Hz
			0,  16777216,  # 0
			0,  16777216,  8388608,  # 1
			0,  16777216,  8388608,  # 2
			0,  8388608,  16777216,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  5592405,  11184810,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  8388608,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  12582912,  8388608,  4194304,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1198372,  2396745,  3595117,  4793490,  5991862,  7190235,  8388608,  9586980,  10785353,  11983725,  13182098,  14380470,  15578843,  16777216,  # 24
	    ],
	"93.75":
	    [  # f_low = 93.75 Hz
			0,  16777216,  # 0
			0,  8388608,  16777216,  # 1
			0,  8388608,  16777216,  # 2
			0,  8388608,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  8388608,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 7
			0,  8388608,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 12
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 21
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 22
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  15486660,  14196105,  12905550,  11614995,  10324440,  9033885,  7743330,  6452775,  5162220,  3871665,  2581110,  1290555,  # 23
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  # 24
	    ],
	"125":
	    [   # f_low = 125 Hz
			0,  16777216,  # 0
			0,  8388608,  16777216,  # 1
			0,  8388608,  16777216,  # 2
			0,  8388608,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  8388608,  16777216,  11184810,  5592405,  # 6
			0,  8388608,  16777216,  11184810,  5592405,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 16
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 18
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 22
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15486660,  14196105,  12905550,  11614995,  10324440,  9033885,  7743330,  6452775,  5162220,  3871665,  2581110,  1290555,  # 23
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  # 24
	    ],
	"155":
		[
			0,  8388608,  16777216,  # 0
			0,  8388608,  16777216,  # 1
			0,  8388608,  16777216,  # 2
			0,  8388608,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  5592405,  11184810,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 7
			0,  8388608,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 11
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  # 24
		],
	"156.25":
	    [   # f_low = 156.25 Hz
			0,  16777216,  # 0
			0,  8388608,  16777216,  # 1
			0,  8388608,  16777216,  8388608,  # 2
			0,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  5592405,  11184810,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 7
			0,  8388608,  16777216,  11184810,  5592405,  # 8
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  12582912,  8388608,  4194304,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  # 24
	    ],
	"187":
		[
			0,  8388608,  16777216,  # 0
			0,  8388608,  16777216,  # 1
			0,  8388608,  16777216,  8388608,  # 2
			0,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  5592405,  11184810,  16777216,  8388608,  # 5
			0,  8388608,  16777216,  11184810,  5592405,  # 6
			0,  8388608,  16777216,  11184810,  5592405,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 12
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13421772,  10066329,  6710886,  3355443,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 16
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  1864135,  3728270,  5592405,  7456540,  9320675,  11184810,  13048945,  14913080,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 21
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1290555,  2581110,  3871665,  5162220,  6452775,  7743330,  9033885,  10324440,  11614995,  12905550,  14196105,  15486660,  16777216,  # 24
		],
	"249":
		[
			0,  8388608,  16777216,  # 0
			0,  8388608,  16777216,  8388608,  # 1
			0,  16777216,  8388608,  # 2
			0,  8388608,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  8388608,  # 5
			0,  5592405,  11184810,  16777216,  8388608,  # 6
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 9
			0,  4194304,  8388608,  12582912,  16777216,  11184810,  5592405,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 12
			0,  4194304,  8388608,  12582912,  16777216,  13421772,  10066329,  6710886,  3355443,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13421772,  10066329,  6710886,  3355443,  # 14
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13421772,  10066329,  6710886,  3355443,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 16
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  14380470,  11983725,  9586980,  7190235,  4793490,  2396745,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15099494,  13421772,  11744051,  10066329,  8388608,  6710886,  5033164,  3355443,  1677721,  # 21
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  # 24
		],
	"280":
		[
			0,  8388608,  16777216,  # 0
			0,  8388608,  16777216,  8388608,  # 1
			0,  16777216,  8388608,  # 2
			0,  8388608,  16777216,  8388608,  # 3
			0,  8388608,  16777216,  8388608,  # 4
			0,  8388608,  16777216,  11184810,  5592405,  # 5
			0,  8388608,  16777216,  11184810,  5592405,  # 6
			0,  8388608,  16777216,  11184810,  5592405,  # 7
			0,  5592405,  11184810,  16777216,  11184810,  5592405,  # 8
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 9
			0,  5592405,  11184810,  16777216,  12582912,  8388608,  4194304,  # 10
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 11
			0,  4194304,  8388608,  12582912,  16777216,  12582912,  8388608,  4194304,  # 12
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  12582912,  8388608,  4194304,  # 13
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 14
			0,  3355443,  6710886,  10066329,  13421772,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 15
			0,  2796202,  5592405,  8388608,  11184810,  13981013,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 16
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  13981013,  11184810,  8388608,  5592405,  2796202,  # 17
			0,  2396745,  4793490,  7190235,  9586980,  11983725,  14380470,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 18
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14680064,  12582912,  10485760,  8388608,  6291456,  4194304,  2097152,  # 19
			0,  2097152,  4194304,  6291456,  8388608,  10485760,  12582912,  14680064,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 20
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  14913080,  13048945,  11184810,  9320675,  7456540,  5592405,  3728270,  1864135,  # 21
			0,  1677721,  3355443,  5033164,  6710886,  8388608,  10066329,  11744051,  13421772,  15099494,  16777216,  15252014,  13726813,  12201611,  10676410,  9151208,  7626007,  6100805,  4575604,  3050402,  1525201,  # 22
			0,  1525201,  3050402,  4575604,  6100805,  7626007,  9151208,  10676410,  12201611,  13726813,  15252014,  16777216,  15379114,  13981013,  12582912,  11184810,  9786709,  8388608,  6990506,  5592405,  4194304,  2796202,  1398101,  # 23
			0,  1398101,  2796202,  4194304,  5592405,  6990506,  8388608,  9786709,  11184810,  12582912,  13981013,  15379114,  16777216,  # 24
		],
}
# fmt: on

def mel_to_c_convert(mel_fb_py_scaled):
    ###################################### Convert Python FB to C FB format ############################################
    # prepare format of filters to match C code table format
    # select every 2nd filter (the rest will be reconstructed from the existing filters!)
    # remove all zeros except one in front of each non-zero value in each filter
    new_fb = [[] for x in range(mel_fb_py_scaled.shape[0])]
    for idx in range(mel_fb_py_scaled.shape[0]):
        tmp = [0] + [int(x) for x in mel_fb_py_scaled[idx] if x != 0]
        new_fb[idx].append(tmp)
    new_list = np.array([x[0] for x in new_fb])
    new_list = [x for k, x in enumerate(new_list) if k % 2 == 0]

    return new_list



################################################### Parameter settings #################################################
Fs = 16000
nfft = 512
n_filters = 10
f_low_list = [0, 31.25, 62.5, 93.75, 125, 155, 156.25, 187, 249, 280]
dir2save = os.path.join(os.path.dirname(__file__), "FB_tables")
if not os.path.exists(dir2save):
    os.makedirs(dir2save)


############################################## Compute filterbank ######################################################
for fdx, f_low in enumerate(f_low_list):
    # compute FB
    mel_fb_py = mel_filterbank(Fs=Fs, nfft=nfft, n_filters=n_filters, f_low=f_low)

    # rescale FB
    mel_fb_py_scaled = mel_fb_py * VAD_MEL_MAX

    # add half of the last filter
    idx_start = np.where(mel_fb_py_scaled[n_filters - 1] == np.max(mel_fb_py_scaled[n_filters - 1]))[0][0]
    new_mel_filter = np.zeros(nfft // 2 + 1)
    new_mel_filter[idx_start:] = VAD_MEL_MAX - mel_fb_py_scaled[n_filters - 1][idx_start:]

    # add extra filter at the end and update FB (needed for C code)
    mel_fb_py_scaled = np.vstack((mel_fb_py_scaled, new_mel_filter.T))

    ######################################## Save full Python filterbank to file #######################################
    # save complete filter to file (easy to copy-paste in C code)
    file2save = os.path.join(dir2save, "FB_full_" + str(f_low) + "Hz.npy")
    np.save(file2save, mel_fb_py_scaled)


    new_list = mel_to_c_convert(mel_fb_py_scaled)
    print(f_low, new_list)

    ############################################# Save C filterbank to file ############################################
    # save filter to file (easy to copy-paste in C code)
    with open(os.path.join(dir2save, "FB_new_" + str(f_low) + "Hz.txt"), "w") as f:
        for idx, x in enumerate(new_list):
            new = [str(y) + ", " for y in x]
            f.write("%s" % " ".join(new))
            f.write(" # %d\n" % idx)

    ############################################### Plot filterbanks ###################################################
    if PLOTTING:
        fig, axes = plt.subplots(1, ncols=1, figsize=[16, 6])
        fig.canvas.set_window_title("f_low = " + str(f_low))

        # axes.plot(mel_fb_c[str(f_low)], "b", label="FB_c")  # C filterbank
        flat_new_list = [item for sublist in new_list for item in sublist]
        print(flat_new_list)
        print(mel_fb_c[str(f_low)])
        axes.plot(flat_new_list, "b", label="FB_c")  # C filterbank
        for idx in range(n_filters):  # Python filterbank
            if idx == 0:
                axes.plot(mel_fb_py_scaled[idx], "r--", label="FB_py")
            else:
                axes.plot(mel_fb_py_scaled[idx], "r--")

        axes.set_xlim(0, nfft / 2 + 1)
        axes.legend(loc="upper right")

        # save to file
        plt.savefig(os.path.join(dir2save, "FB_new_" + str(f_low) + "Hz.png"), dpi=200)

        # close figure
        plt.close()