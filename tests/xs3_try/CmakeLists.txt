cmake_minimum_required(VERSION 3.14)
set(AIOT_PATH /Users/ed/sandboxes/aiot_sdk)

include("${AIOT_PATH}/tools/cmake_utils/xmos_toolchain.cmake") 
enable_language(CXX XC C ASM)

set(APP_NAME app_features)
project(${APP_NAME} VERSION 0.1.0)

set(INSTALL_DIR "${PROJECT_SOURCE_DIR}/bin")

add_executable(${APP_NAME})

set(XS3_MATH_PATH ${AIOT_PATH}/modules/lib_xs3_math/lib_xs3_math)
set(VTB_PATH ${AIOT_PATH}/modules/lib_voice_toolbox/lib_voice_toolbox)
set(DSP_PATH ${AIOT_PATH}/modules/lib_dsp/lib_dsp/lib_dsp)



set(BUILD_FLAGS
        "-Os"
        "-g"
        "-target=XCORE-AI-EXPLORER"
        )

set(APP_SRCS
        ./src/main.c
        ./src/xs3_fft_lut.c
    )

set(APP_INCLUDES
        "src"
    )

file(GLOB_RECURSE XS3_MATH_C_SRCS ${XS3_MATH_PATH}/src/*.c)
file(GLOB_RECURSE XS3_MATH_S_SRCS ${XS3_MATH_PATH}/src/*.S)


set(VTB_SRCS
        ${VTB_PATH}/src/bfp/vtb_utilities.xc
    )


target_include_directories(${APP_NAME}
  PRIVATE ${APP_INCLUDES}
  PRIVATE ${XS3_MATH_PATH}/api
  PRIVATE ${XS3_MATH_PATH}/src/arch/xcore
  PRIVATE ${VTB_PATH}/api
  PRIVATE ${DSP_PATH}/api
)

target_sources(${APP_NAME}
    PRIVATE ${APP_SRCS}
    PRIVATE ${XS3_MATH_C_SRCS}
    PRIVATE ${XS3_MATH_S_SRCS}
    PRIVATE ${VTB_SRCS}
)

target_compile_options(${APP_NAME}  PRIVATE ${BUILD_FLAGS})
target_link_options(${APP_NAME} PRIVATE ${BUILD_FLAGS})

install(TARGETS ${APP_NAME} DESTINATION ${INSTALL_DIR})

